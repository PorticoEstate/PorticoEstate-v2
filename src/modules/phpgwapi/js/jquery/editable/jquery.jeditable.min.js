(function($){$.fn.editable=function(t,e){var i={target:t,name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"...",loaddata:{},submitdata:{},ajaxoptions:{}};e&&$.extend(i,e);var n=function(t){return"function"==typeof t},a=function(t){return String(t||"").trim()},l=$.editable.types[i.type].plugin||function(){},s=$.editable.types[i.type].submit||function(){},r=$.editable.types[i.type].buttons||$.editable.types.defaults.buttons,o=$.editable.types[i.type].content||$.editable.types.defaults.content,p=$.editable.types[i.type].element||$.editable.types.defaults.element,u=$.editable.types[i.type].reset||$.editable.types.defaults.reset,d=i.callback||function(){},c=i.onsubmit||function(){},h=i.onreset||function(){},y=i.onerror||u;return n($(this)[i.event])||($.fn[i.event]=function(t){return t?this.on(i.event,t):this.trigger(i.event)}),$(this).attr("title",i.tooltip),i.autowidth="auto"==i.width,i.autoheight="auto"==i.height,this.each(function(){var t=this,e=$(t).width(),f=$(t).height();a($(this).html())||$(this).html(i.placeholder),$(this)[i.event](function(h){if(!t.editing){$(t).removeAttr("title"),0==$(t).width()?(i.width=e,i.height=f):("none"!=i.width&&(i.width=i.autowidth?$(t).width():i.width),"none"!=i.height&&(i.height=i.autoheight?$(t).height():i.height)),$(this).html().toLowerCase().replace(/;/,"")==i.placeholder.toLowerCase().replace(/;/,"")&&$(this).html(""),t.editing=!0,t.revert=$(t).html(),$(t).html("");var m=$("<form />");i.cssclass&&("inherit"==i.cssclass?m.attr("class",$(t).attr("class")):m.attr("class",i.cssclass)),i.style&&("inherit"==i.style?(m.attr("style",$(t).attr("style")),m.css("display",$(t).css("display"))):m.attr("style",i.style));var b,v=p.apply(m,[i,t]);if(i.loadurl){var g=setTimeout(function(){v.disabled=!0,o.apply(m,[i.loadtext,i,t])},100),w={};w[i.id]=t.id,n(i.loaddata)?$.extend(w,i.loaddata.apply(t,[t.revert,i])):$.extend(w,i.loaddata),$.ajax({type:i.loadtype,url:i.loadurl,data:w,async:!1,success:function(t){window.clearTimeout(g),b=t,v.disabled=!1}})}else i.data?(b=i.data,n(i.data)&&(b=i.data.apply(t,[t.revert,i]))):b=t.revert;o.apply(m,[b,i,t]),v.attr("name",i.name),r.apply(m,[i,t]),$(t).append(m),l.apply(m,[i,t]),$(":input:visible:enabled:first",m).focus(),i.select&&v.select(),v.keydown(function(e){27==e.keyCode&&(e.preventDefault(),u.apply(m,[i,t]))}),"cancel"==i.onblur?v.blur(function(e){g=setTimeout(function(){u.apply(m,[i,t])},500)}):"submit"==i.onblur?v.blur(function(t){g=setTimeout(function(){m.submit()},200)}):n(i.onblur)?v.blur(function(e){i.onblur.apply(t,[v.val(),i])}):v.blur(function(t){}),m.submit(function(e){if(g&&clearTimeout(g),e.preventDefault(),!1!==c.apply(m,[i,t])&&!1!==s.apply(m,[i,t]))if(n(i.target)){var l=i.target.apply(t,[v.val(),i]);$(t).html(l),t.editing=!1,d.apply(t,[t.innerHTML,i]),a($(t).html())||$(t).html(i.placeholder)}else{var r={};r[i.name]=v.val(),r[i.id]=t.id,n(i.submitdata)?$.extend(r,i.submitdata.apply(t,[t.revert,i])):$.extend(r,i.submitdata),"PUT"==i.method&&(r._method="put"),$(t).html(i.indicator);var o={type:"POST",data:r,url:i.target,success:function(e,n){$(t).html(e),t.editing=!1,d.apply(t,[t.innerHTML,i]),a($(t).html())||$(t).html(i.placeholder)},error:function(e,n,a){y.apply(m,[i,t,e])}};$.extend(o,i.ajaxoptions),$.ajax(o)}return $(t).attr("title",i.tooltip),!1})}}),this.reset=function(e){this.editing&&!1!==h.apply(e,[i,t])&&($(t).html(t.revert),t.editing=!1,a($(t).html())||$(t).html(i.placeholder),$(t).attr("title",i.tooltip))}})},$.editable={types:{defaults:{element:function(t,e){var i=$('<input type="hidden"></input>');return $(this).append(i),i},content:function(t,e,i){$(":input:first",this).val(t)},reset:function(t,e){e.reset(this)},buttons:function(t,e){var i=this;if(t.submit){if(t.submit.match(/>$/))var n=$(t.submit).click(function(){"submit"!=n.attr("type")&&i.submit()});else(n=$('<button type="submit" />')).html(t.submit);$(this).append(n)}if(t.cancel){if(t.cancel.match(/>$/))var a=$(t.cancel);else(a=$('<button type="cancel" />')).html(t.cancel);$(this).append(a),$(a).click(function(n){if(isFunction($.editable.types[t.type].reset))var a=$.editable.types[t.type].reset;else a=$.editable.types.defaults.reset;return a.apply(i,[t,e]),!1})}}},text:{element:function(t,e){var i=$("<input />");return"none"!=t.width&&i.width(t.width),"none"!=t.height&&i.height(t.height),i.attr("autocomplete","off"),$(this).append(i),i}},textarea:{element:function(t,e){var i=$("<textarea />");return t.rows?i.attr("rows",t.rows):i.height(t.height),t.cols?i.attr("cols",t.cols):i.width(t.width),$(this).append(i),i}},select:{element:function(t,e){var i=$("<select />");return $(this).append(i),i},content:function(string,settings,original){if(String==string.constructor)for(var key in eval("var json = "+string),json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){$(this).val()!=json.selected&&$(this).text()!=original.revert||$(this).attr("selected","selected")})}}},addInputType:function(t,e){$.editable.types[t]=e}}})(jQuery);