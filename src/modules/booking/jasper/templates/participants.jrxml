<!-- Created with Jaspersoft Studio version 7.0.3.final using JasperReports Library version 7.0.3-41034ca841d452f3305ba55b9042260aaa1ab5dd  -->
<jasperReport name="BKParticipants" language="java" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="30" bottomMargin="30" uuid="78db7040-bf83-4fa6-9d6c-cdf3fc4bced7" floatColumnFooter="true">
	<property name="net.sf.jasperreports.export.pdf.tagged" value="true"/>
	<property name="net.sf.jasperreports.export.pdf.tag.language" value="EN-US"/>
	<style name="Sans_Normal" default="true" fontName="DejaVu Sans" fontSize="8.0" bold="false" italic="false" underline="false" strikeThrough="false"/>
	<style name="Sans_Bold" fontName="DejaVu Sans" fontSize="8.0" bold="true" italic="false" underline="false" strikeThrough="false"/>
	<dataset name="ByBuilding_preview" uuid="112e5b71-7372-4b19-bf98-085974bc4b16">
		<parameter name="DATE_FROM" class="java.lang.String"/>
		<parameter name="DATE_TO" class="java.lang.String"/>
		<parameter name="BUILDING_ID" class="java.lang.Integer"/>
		<query language="sql"><![CDATA[SELECT to_char(bo.from_, 'YYYY-MM') AS month, ag.name AS aname, ba.male, ba.female, bu.id, bu.name, ag.sort as agegroup_sort
				FROM bb_agegroup ag, bb_booking_agegroup ba, bb_booking bo, bb_allocation al, bb_season se, bb_building bu 
				WHERE ba.agegroup_id = ag.id 
				AND ba.booking_id = bo.id
				AND bo.allocation_id = al.id
				AND al.season_id = se.id 
				AND se.building_id = bu.id 
				AND ag.active = 1
				AND date_trunc('day' ,bo.from_) >= to_date($P{DATE_FROM} ,'YYYY-MM-DD')
				AND date_trunc('day' ,bo.from_) <= to_date($P{DATE_TO}, 'YYYY-MM-DD')
				AND bu.id = $P{BUILDING_ID}
				UNION
				SELECT to_char(ev.from_, 'YYYY-MM') AS month, ag.name AS aname, ea.male, ea.female, bu.id, bu.name, ag.sort AS agegroup_sort
				FROM bb_event ev
				INNER JOIN bb_event_agegroup ea ON ea.event_id = ev.id
				INNER JOIN bb_agegroup ag ON ag.id = ea.agegroup_id and ag.active = 1
				INNER JOIN bb_event_resource er ON er.event_id = ev.id
				INNER JOIN bb_building_resource br ON br.resource_id = er.resource_id
				INNER JOIN bb_building bu ON bu.id = br.building_id
				WHERE date_trunc('day' ,ev.from_) >= to_date($P{DATE_FROM} ,'YYYY-MM-DD')
				AND date_trunc('day' ,ev.from_) <= to_date($P{DATE_TO}, 'YYYY-MM-DD')
				AND bu.id = $P{BUILDING_ID}
				ORDER BY month desc, agegroup_sort]]></query>
		<field name="month" class="java.lang.String"/>
		<field name="aname" class="java.lang.String"/>
		<field name="male" class="java.lang.Integer"/>
		<field name="female" class="java.lang.Integer"/>
	</dataset>
	<parameter name="BK_DATE_FROM" class="java.lang.String"/>
	<parameter name="BK_DATE_TO" class="java.lang.String"/>
	<parameter name="BK_BUILDINGS" class="java.lang.String"/>
	<query language="sql"><![CDATA[SELECT DISTINCT bu.id AS building_id, bu.name AS building_name
			FROM bb_booking bo
			INNER JOIN bb_allocation al ON al.id = bo.allocation_id
			INNER JOIN bb_season se ON se.id = al.season_id
			INNER JOIN bb_building bu ON bu.id = se.building_id
			WHERE date_trunc('day', bo.from_) >= to_date($P{BK_DATE_FROM}, 'YYYY-MM-DD')
			AND date_trunc('day', bo.from_) <= to_date($P{BK_DATE_TO}, 'YYYY-MM-DD')
			AND bu.id = ANY (string_to_array($P{BK_BUILDINGS}, ',')::int4[])
			UNION
			SELECT DISTINCT bu.id AS building_id, bu.name AS building_name
			FROM bb_event ev
			INNER JOIN bb_event_resource er on er.event_id = ev.id
			INNER JOIN bb_building_resource br ON br.resource_id = er.resource_id
			INNER JOIN bb_building bu on bu.id = br.building_id
			WHERE date_trunc('day', ev.from_) >= to_date($P{BK_DATE_FROM}, 'YYYY-MM-DD')
			AND date_trunc('day', ev.from_) <= to_date($P{BK_DATE_TO}, 'YYYY-MM-DD')
			AND bu.id = ANY (string_to_array($P{BK_BUILDINGS}, ',')::int4[])
			ORDER BY building_name]]></query>
	<field name="building_id" class="java.lang.Integer"/>
	<field name="building_name" class="java.lang.String"/>
	<title height="80" splitType="Prevent">
		<element kind="staticText" uuid="2c0cc210-b2ff-4ca1-b91f-e5da17a4ad2d" x="20" y="5" width="750" height="30" fontSize="18.0" hTextAlign="Center">
			<text><![CDATA[Deltagere per aldersgruppe per mÃ¥ned]]></text>
			<property name="net.sf.jasperreports.export.pdf.tag.h1" value="full"/>
		</element>
		<element kind="textField" uuid="d45ad8f6-5eb2-4cad-97d0-ce8512d42ed5" x="20" y="35" width="750" height="40" fontSize="16.0" hTextAlign="Center">
			<expression><![CDATA["(" + $P{BK_DATE_FROM} + " - " + $P{BK_DATE_TO} + ")"]]></expression>
			<property name="net.sf.jasperreports.export.pdf.tag.h1" value="full"/>
		</element>
	</title>
	<detail>
		<band height="130" splitType="Prevent">
			<element kind="textField" uuid="d150a9de-d065-44b8-93d3-a7e353a286d6" x="0" y="20" width="500" height="35" fontSize="10.0" style="Sans_Bold">
				<expression><![CDATA["Bygg/Anlegg: " + $F{building_name}]]></expression>
			</element>
			<element kind="crosstab" uuid="7248bb06-0512-4ee6-a727-cce4e98562a3" x="0" y="60" width="782" height="70" repeatColumnHeaders="false">
				<dataset>
					<datasetRun uuid="14e440a8-bd42-4482-bdcd-e7339c48c825" subDataset="ByBuilding_preview">
						<parameter name="BUILDING_ID">
							<expression><![CDATA[$F{building_id}]]></expression>
						</parameter>
						<parameter name="DATE_FROM">
							<expression><![CDATA[$P{BK_DATE_FROM}]]></expression>
						</parameter>
						<parameter name="DATE_TO">
							<expression><![CDATA[$P{BK_DATE_TO}]]></expression>
						</parameter>
					</datasetRun>
				</dataset>
				<whenNoDataCell>
					<element kind="staticText" uuid="15c36de9-06e2-4bb8-82bc-b94cbbeeb8fb" x="0" y="0" width="250" height="25">
						<text><![CDATA[No data]]></text>
					</element>
				</whenNoDataCell>
				<rowGroup name="MonthGroup" totalPosition="End" width="75">
					<bucket class="java.lang.String">
						<expression><![CDATA[$F{month}]]></expression>
					</bucket>
					<header>
						<element kind="textField" uuid="e2e3911f-2bf5-4e9b-b921-cffba2c22e8c" x="5" y="0" width="70" height="10" style="Sans_Bold">
							<expression><![CDATA[$V{MonthGroup}]]></expression>
						</element>
						<box>
							<pen lineWidth="0.5"/>
						</box>
					</header>
					<totalHeader mode="Opaque" backcolor="#E0FFFF">
						<element kind="staticText" uuid="d519d890-fd3e-4609-b11e-03e1c983c395" x="5" y="0" width="70" height="10" style="Sans_Bold">
							<text><![CDATA[TOTAL]]></text>
						</element>
						<box>
							<pen lineWidth="0.5"/>
						</box>
					</totalHeader>
				</rowGroup>
				<columnGroup name="AgeGroup" totalPosition="End" height="80" position="Stretch">
					<bucket class="java.lang.String">
						<expression><![CDATA[$F{aname}]]></expression>
					</bucket>
					<header>
						<element kind="textField" uuid="31098229-5161-47d0-affb-7e26ca937a54" x="0" y="0" width="80" height="70" rotation="Left" hTextAlign="Center" vTextAlign="Middle" style="Sans_Bold">
							<expression><![CDATA[$V{AgeGroup}]]></expression>
						</element>
						<element kind="staticText" uuid="7788072b-aec3-4e79-bc66-c111b45ed747" x="0" y="70" width="40" height="10" hTextAlign="Center" vTextAlign="Middle" style="Sans_Bold">
							<text><![CDATA[M]]></text>
						</element>
						<element kind="staticText" uuid="e4a0a11d-668c-4634-a096-3c8a311c34d5" x="40" y="70" width="40" height="10" hTextAlign="Center" vTextAlign="Middle" style="Sans_Bold">
							<text><![CDATA[K]]></text>
						</element>
						<box>
							<pen lineWidth="0.5"/>
						</box>
					</header>
					<totalHeader mode="Opaque" backcolor="#FFFF60">
						<element kind="staticText" uuid="25e41888-66e3-4c59-9007-a4cf531f311d" x="0" y="0" width="80" height="70" hTextAlign="Center" vTextAlign="Middle" style="Sans_Bold">
							<text><![CDATA[TOTAL]]></text>
						</element>
						<element kind="staticText" uuid="d0ece602-2e08-4e0a-9bcf-69591233db7c" x="0" y="70" width="40" height="10" hTextAlign="Center" vTextAlign="Middle" style="Sans_Bold">
							<text><![CDATA[M]]></text>
						</element>
						<element kind="staticText" uuid="c2a99556-db8e-4525-9d6e-2414cab307b8" x="40" y="70" width="40" height="10" hTextAlign="Center" vTextAlign="Middle" style="Sans_Bold">
							<text><![CDATA[K]]></text>
						</element>
						<box>
							<pen lineWidth="0.5"/>
						</box>
					</totalHeader>
				</columnGroup>
				<measure name="MaleMesure" calculation="Sum" class="java.lang.Integer">
					<expression><![CDATA[$F{male}]]></expression>
				</measure>
				<measure name="FemaleMesure" calculation="Sum" class="java.lang.Integer">
					<expression><![CDATA[$F{female}]]></expression>
				</measure>
				<cell width="80" height="10">
					<contents mode="Opaque" backcolor="#FFFFFF">
						<element kind="textField" uuid="b63002dd-ee22-4847-baef-5589b419ffd4" x="0" y="0" width="40" height="10" hTextAlign="Center" vTextAlign="Middle">
							<expression><![CDATA[$V{MaleMesure}]]></expression>
						</element>
						<element kind="textField" uuid="adead324-f868-46fb-bcb8-8d1aaffb956c" x="40" y="0" width="40" height="10" hTextAlign="Center" vTextAlign="Middle">
							<expression><![CDATA[$V{FemaleMesure}]]></expression>
						</element>
						<box>
							<pen lineWidth="0.5"/>
						</box>
					</contents>
				</cell>
				<cell width="80" height="10" columnTotalGroup="AgeGroup">
					<contents mode="Opaque" backcolor="#FFFF60">
						<element kind="textField" uuid="ce88d951-5ee2-4def-99ef-8549a7d42363" x="0" y="0" width="40" height="10" hTextAlign="Center" vTextAlign="Middle">
							<expression><![CDATA[$V{MaleMesure}]]></expression>
						</element>
						<element kind="textField" uuid="b3c4c802-4542-406f-b0dd-fca143dc756c" x="40" y="0" width="40" height="10" hTextAlign="Center" vTextAlign="Middle">
							<expression><![CDATA[$V{FemaleMesure}]]></expression>
						</element>
						<box>
							<pen lineWidth="0.5"/>
						</box>
					</contents>
				</cell>
				<cell width="80" height="10" rowTotalGroup="MonthGroup">
					<contents mode="Opaque" backcolor="#E0FFFF">
						<element kind="textField" uuid="1af9c191-f171-470d-94f4-08d14b56987d" x="0" y="0" width="40" height="10" hTextAlign="Center" vTextAlign="Middle">
							<expression><![CDATA[$V{MaleMesure}]]></expression>
						</element>
						<element kind="textField" uuid="4c4a3c1a-1fff-4ea8-8904-4844ec9f55a5" x="40" y="0" width="40" height="10" hTextAlign="Center" vTextAlign="Middle">
							<expression><![CDATA[$V{FemaleMesure}]]></expression>
						</element>
						<box>
							<pen lineWidth="0.5"/>
						</box>
					</contents>
				</cell>
				<cell width="80" height="10" rowTotalGroup="MonthGroup" columnTotalGroup="AgeGroup">
					<contents mode="Opaque" backcolor="#C0C0C0">
						<element kind="textField" uuid="a07c80a8-ec0e-4fb5-b157-fb2ec2e002c3" x="0" y="0" width="40" height="10" hTextAlign="Center" vTextAlign="Middle" style="Sans_Bold">
							<expression><![CDATA[$V{MaleMesure}]]></expression>
						</element>
						<element kind="textField" uuid="48aceda8-f05b-4557-9c63-bbf002e6b54d" x="40" y="0" width="40" height="10" hTextAlign="Center" vTextAlign="Middle" style="Sans_Bold">
							<expression><![CDATA[$V{FemaleMesure}]]></expression>
						</element>
						<box>
							<pen lineWidth="0.5"/>
						</box>
					</contents>
				</cell>
				<parameter name="BUILDING_ID" class="java.lang.Integer">
					<expression><![CDATA[$F{building_id}]]></expression>
				</parameter>
			</element>
		</band>
	</detail>
</jasperReport>
