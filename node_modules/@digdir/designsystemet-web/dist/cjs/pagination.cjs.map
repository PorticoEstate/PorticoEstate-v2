{"version":3,"file":"pagination.cjs","names":["DSElement","attr","onMutation","customElements"],"sources":["../../src/pagination.ts"],"sourcesContent":["import {\r\n  attr,\r\n  attrRequiredWarning,\r\n  customElements,\r\n  DSElement,\r\n  onMutation,\r\n} from './utils';\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'ds-pagination': DSPaginationElement;\r\n  }\r\n}\r\n\r\nconst ATTR_LABEL = 'aria-label';\r\nconst ATTR_CURRENT = 'data-current';\r\nconst ATTR_TOTAL = 'data-total';\r\nconst ATTR_HREF = 'data-href';\r\n\r\n// Expose pagination logic if wanting to do custom rendering (i.e. in React/Vue/etc)\r\nexport const pagination = ({ current = 1, total = 10, show = 7 }) => ({\r\n  prev: current > 1 ? current - 1 : 0,\r\n  next: current < total ? current + 1 : 0,\r\n  pages: getSteps(current, total, show).map((page, index) => ({\r\n    current: page === current && ('page' as const),\r\n    key: `key-${page}-${index}`,\r\n    page,\r\n  })),\r\n});\r\n\r\nexport class DSPaginationElement extends DSElement {\r\n  _unmutate?: () => void;\r\n\r\n  static get observedAttributes() {\r\n    return [ATTR_CURRENT, ATTR_TOTAL]; // Using ES2015 syntax for backwards compatibility\r\n  }\r\n  connectedCallback() {\r\n    attrRequiredWarning(this, ATTR_LABEL);\r\n    if (attr(this, ATTR_TOTAL)) attrRequiredWarning(this, ATTR_CURRENT);\r\n    if (attr(this, ATTR_CURRENT)) attrRequiredWarning(this, ATTR_TOTAL);\r\n\r\n    this._unmutate = onMutation(this, this.render.bind(this), {\r\n      childList: true,\r\n      subtree: true,\r\n      debounce: 0,\r\n    });\r\n  }\r\n  disconnectedCallback() {\r\n    this._unmutate?.();\r\n    this._unmutate = undefined;\r\n  }\r\n  render() {\r\n    const items = this.querySelectorAll('button,a');\r\n    const href = attr(this, ATTR_HREF);\r\n    const CURRENT = attr(this, ATTR_CURRENT) || undefined;\r\n    const TOTAL = attr(this, ATTR_TOTAL) || undefined;\r\n\r\n    if (!CURRENT || !TOTAL) return;\r\n\r\n    const { next, prev, pages } = pagination({\r\n      current: parseInt(CURRENT, 10),\r\n      total: parseInt(TOTAL, 10),\r\n      show: items.length - 2,\r\n    });\r\n\r\n    items.forEach((item, i) => {\r\n      const page = i ? (items[i + 1] ? pages[i - 1]?.page : next) : prev; // First is prev, last is next\r\n      attr(item, 'aria-current', pages[i - 1]?.current ? 'true' : null);\r\n      attr(item, 'aria-hidden', page ? null : 'true');\r\n      attr(item, 'data-page', `${page}`);\r\n      attr(item, 'tabindex', page ? null : '-1');\r\n      if (item instanceof HTMLButtonElement) attr(item, 'value', `${page}`);\r\n      if (href) attr(item, 'href', href.replace('$page', `${page}`));\r\n    });\r\n  }\r\n}\r\n\r\ncustomElements.define('ds-pagination', DSPaginationElement);\r\n\r\nfunction getSteps(now: number, max: number, show = Number.POSITIVE_INFINITY) {\r\n  const offset = (show - 1) / 2;\r\n  const start = Math.max(Math.min(now - Math.floor(offset), max - show + 1), 1);\r\n  const end = Math.min(Math.max(now + Math.ceil(offset), show), max);\r\n  const pages = Array.from({ length: end + 1 - start }, (_, i) => i + start);\r\n\r\n  if (show > 4 && start > 1) pages.splice(0, 2, 1, 0);\r\n  if (show > 3 && end < max) pages.splice(-2, 2, 0, max);\r\n  return pages;\r\n}\r\n"],"mappings":";;;AAcA,MAAM,aAAa;AACnB,MAAM,eAAe;AACrB,MAAM,aAAa;AACnB,MAAM,YAAY;AAGlB,MAAa,cAAc,EAAE,UAAU,GAAG,QAAQ,IAAI,OAAO,SAAS;CACpE,MAAM,UAAU,IAAI,UAAU,IAAI;CAClC,MAAM,UAAU,QAAQ,UAAU,IAAI;CACtC,OAAO,SAAS,SAAS,OAAO,KAAK,CAAC,KAAK,MAAM,WAAW;EAC1D,SAAS,SAAS,WAAY;EAC9B,KAAK,OAAO,KAAK,GAAG;EACpB;EACD,EAAE;CACJ;AAED,IAAa,sBAAb,cAAyCA,wBAAU;CACjD;CAEA,WAAW,qBAAqB;AAC9B,SAAO,CAAC,cAAc,WAAW;;CAEnC,oBAAoB;AAClB,oCAAoB,MAAM,WAAW;AACrC,MAAIC,mBAAK,MAAM,WAAW,CAAE,mCAAoB,MAAM,aAAa;AACnE,MAAIA,mBAAK,MAAM,aAAa,CAAE,mCAAoB,MAAM,WAAW;AAEnE,OAAK,YAAYC,yBAAW,MAAM,KAAK,OAAO,KAAK,KAAK,EAAE;GACxD,WAAW;GACX,SAAS;GACT,UAAU;GACX,CAAC;;CAEJ,uBAAuB;AACrB,OAAK,aAAa;AAClB,OAAK,YAAY;;CAEnB,SAAS;EACP,MAAM,QAAQ,KAAK,iBAAiB,WAAW;EAC/C,MAAM,OAAOD,mBAAK,MAAM,UAAU;EAClC,MAAM,UAAUA,mBAAK,MAAM,aAAa,IAAI;EAC5C,MAAM,QAAQA,mBAAK,MAAM,WAAW,IAAI;AAExC,MAAI,CAAC,WAAW,CAAC,MAAO;EAExB,MAAM,EAAE,MAAM,MAAM,UAAU,WAAW;GACvC,SAAS,SAAS,SAAS,GAAG;GAC9B,OAAO,SAAS,OAAO,GAAG;GAC1B,MAAM,MAAM,SAAS;GACtB,CAAC;AAEF,QAAM,SAAS,MAAM,MAAM;GACzB,MAAM,OAAO,IAAK,MAAM,IAAI,KAAK,MAAM,IAAI,IAAI,OAAO,OAAQ;AAC9D,sBAAK,MAAM,gBAAgB,MAAM,IAAI,IAAI,UAAU,SAAS,KAAK;AACjE,sBAAK,MAAM,eAAe,OAAO,OAAO,OAAO;AAC/C,sBAAK,MAAM,aAAa,GAAG,OAAO;AAClC,sBAAK,MAAM,YAAY,OAAO,OAAO,KAAK;AAC1C,OAAI,gBAAgB,kBAAmB,oBAAK,MAAM,SAAS,GAAG,OAAO;AACrE,OAAI,KAAM,oBAAK,MAAM,QAAQ,KAAK,QAAQ,SAAS,GAAG,OAAO,CAAC;IAC9D;;;AAINE,6BAAe,OAAO,iBAAiB,oBAAoB;AAE3D,SAAS,SAAS,KAAa,KAAa,OAAO,OAAO,mBAAmB;CAC3E,MAAM,UAAU,OAAO,KAAK;CAC5B,MAAM,QAAQ,KAAK,IAAI,KAAK,IAAI,MAAM,KAAK,MAAM,OAAO,EAAE,MAAM,OAAO,EAAE,EAAE,EAAE;CAC7E,MAAM,MAAM,KAAK,IAAI,KAAK,IAAI,MAAM,KAAK,KAAK,OAAO,EAAE,KAAK,EAAE,IAAI;CAClE,MAAM,QAAQ,MAAM,KAAK,EAAE,QAAQ,MAAM,IAAI,OAAO,GAAG,GAAG,MAAM,IAAI,MAAM;AAE1E,KAAI,OAAO,KAAK,QAAQ,EAAG,OAAM,OAAO,GAAG,GAAG,GAAG,EAAE;AACnD,KAAI,OAAO,KAAK,MAAM,IAAK,OAAM,OAAO,IAAI,GAAG,GAAG,IAAI;AACtD,QAAO"}