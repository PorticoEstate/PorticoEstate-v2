{"version":3,"file":"clickdelegatefor.cjs","names":["onHotReload","on","QUICK_EVENT"],"sources":["../../src/clickdelegatefor.ts"],"sourcesContent":["// Adding support for click deletagtion, following\r\n// https://open-ui.org/components/link-area-delegation-explainer/\r\n// and https://github.com/openui/open-ui/issues/1104#issuecomment-3151387080\r\nimport { on, onHotReload, QUICK_EVENT } from './utils';\r\n\r\nconst CLASS_HOVER = ':click-delegate-hover';\r\nconst ATTR_CLICKDELEGATEFOR = 'data-clickdelegatefor';\r\nconst SELECTOR_CLICKDELEGATEFOR = `[${ATTR_CLICKDELEGATEFOR}]`;\r\nconst SELECTOR_SKIP =\r\n  'a,button,label,input,select,textarea,dialog,[role=\"button\"],[popover],[contenteditable]';\r\n\r\nexport const handleClickDelegateFor = (event: MouseEvent) => {\r\n  const isNewTab = event.button === 1 || event.metaKey || event.ctrlKey;\r\n  const isUserLeftOrMiddleClick = event.isTrusted && event.button < 2;\r\n  const delegateTarget = isUserLeftOrMiddleClick && getDelegateTarget(event);\r\n\r\n  if (delegateTarget instanceof HTMLAnchorElement && isNewTab)\r\n    window.open(delegateTarget.href, undefined, delegateTarget.rel); // If middle click or cmd/ctrl click on link, open in new tab\r\n  else if (\r\n    delegateTarget instanceof HTMLElement &&\r\n    !delegateTarget.contains(event.target as Node) // Only proxy event if delegated target isn't the original target\r\n  ) {\r\n    event.stopImmediatePropagation(); // We'll trigger a new click event anyway, so prevent actions on this one\r\n    delegateTarget.click(); // Forward click to the clickable element\r\n  }\r\n};\r\n\r\nlet HOVER: Element | undefined;\r\nconst handleMouseOver = (event: Event) => {\r\n  const delegateTarget = getDelegateTarget(event);\r\n  if (HOVER === delegateTarget) return; // No change\r\n  if (HOVER) HOVER.classList.remove(CLASS_HOVER);\r\n  if (delegateTarget) delegateTarget.classList.add(CLASS_HOVER);\r\n  HOVER = delegateTarget;\r\n};\r\n\r\nconst getDelegateTarget = ({ target: el }: Event) => {\r\n  const scope =\r\n    el instanceof Element ? el.closest(SELECTOR_CLICKDELEGATEFOR) : null;\r\n  const id = scope?.getAttribute(ATTR_CLICKDELEGATEFOR);\r\n  const target = document.getElementById(id || '');\r\n  const skip = target && (el as Element).closest(SELECTOR_SKIP); // Ignore if interactive\r\n\r\n  return ((!skip || skip === target) && target) || undefined;\r\n};\r\n\r\nonHotReload('clickdelegatefor', () => [\r\n  on(window, 'click auxclick', handleClickDelegateFor as EventListener, true), // Use capture to ensure we run before other click listeners\r\n  on(document, 'mouseover', handleMouseOver, QUICK_EVENT), // Use passive for better performance\r\n]);\r\n"],"mappings":";;;AAKA,MAAM,cAAc;AACpB,MAAM,wBAAwB;AAC9B,MAAM,4BAA4B,IAAI,sBAAsB;AAC5D,MAAM,gBACJ;AAEF,MAAa,0BAA0B,UAAsB;CAC3D,MAAM,WAAW,MAAM,WAAW,KAAK,MAAM,WAAW,MAAM;CAE9D,MAAM,iBAD0B,MAAM,aAAa,MAAM,SAAS,KAChB,kBAAkB,MAAM;AAE1E,KAAI,0BAA0B,qBAAqB,SACjD,QAAO,KAAK,eAAe,MAAM,QAAW,eAAe,IAAI;UAE/D,0BAA0B,eAC1B,CAAC,eAAe,SAAS,MAAM,OAAe,EAC9C;AACA,QAAM,0BAA0B;AAChC,iBAAe,OAAO;;;AAI1B,IAAI;AACJ,MAAM,mBAAmB,UAAiB;CACxC,MAAM,iBAAiB,kBAAkB,MAAM;AAC/C,KAAI,UAAU,eAAgB;AAC9B,KAAI,MAAO,OAAM,UAAU,OAAO,YAAY;AAC9C,KAAI,eAAgB,gBAAe,UAAU,IAAI,YAAY;AAC7D,SAAQ;;AAGV,MAAM,qBAAqB,EAAE,QAAQ,SAAgB;CAGnD,MAAM,MADJ,cAAc,UAAU,GAAG,QAAQ,0BAA0B,GAAG,OAChD,aAAa,sBAAsB;CACrD,MAAM,SAAS,SAAS,eAAe,MAAM,GAAG;CAChD,MAAM,OAAO,UAAW,GAAe,QAAQ,cAAc;AAE7D,SAAS,CAAC,QAAQ,SAAS,WAAW,UAAW;;AAGnDA,0BAAY,0BAA0B,CACpCC,iBAAG,QAAQ,kBAAkB,wBAAyC,KAAK,EAC3EA,iBAAG,UAAU,aAAa,iBAAiBC,0BAAY,CACxD,CAAC"}