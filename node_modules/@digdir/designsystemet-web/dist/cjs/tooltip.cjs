const require_utils = require('./utils.cjs');

//#region src/tooltip.ts
let TIP;
let SOURCE;
let HOVER_TIMER = 0;
let SKIP_TIMER = 0;
const SELECTOR_TOOLTIP = "[data-tooltip-element]";
const SELECTOR_INTERACTIVE = "a,button,input,select,textarea,[tabindex]";
const DELAY_HOVER = 300;
const DELAY_SKIP = 300;
function handleAriaAttributes() {
	for (const el of document.querySelectorAll("[data-tooltip]")) {
		const hasText = el.textContent?.trim();
		const tooltip = require_utils.attr(el, "data-tooltip");
		require_utils.attr(el, hasText ? "aria-description" : "aria-label", tooltip);
		if (!el.matches(SELECTOR_INTERACTIVE)) require_utils.attrRequiredWarning(el, "tabindex=\"0\"");
	}
}
function handleInterest({ type, target }) {
	clearTimeout(HOVER_TIMER);
	if (!TIP) TIP = document.querySelector(SELECTOR_TOOLTIP) || require_utils.tag("div", { class: "ds-tooltip" });
	if (!TIP || target === TIP) return;
	if (type === "mouseover" && !SOURCE) {
		HOVER_TIMER = setTimeout(handleInterest, DELAY_HOVER, { target });
		return;
	}
	const source = target?.closest?.("[data-tooltip]");
	if (source === SOURCE) return;
	if (!TIP.isConnected) document.body.appendChild(TIP);
	if (!TIP.hasAttribute("popover")) require_utils.attr(TIP, "popover", "manual");
	if (!source) return TIP?.hidePopover();
	clearTimeout(SKIP_TIMER);
	TIP.textContent = require_utils.attr(source, "data-tooltip");
	TIP.showPopover();
	TIP.dispatchEvent(new CustomEvent("ds-toggle-source", { detail: source }));
	SOURCE = source;
}
function handleClose(event) {
	if (!event) SOURCE = void 0;
	else if (event.target === TIP && event.newState === "closed") SKIP_TIMER = setTimeout(handleClose, DELAY_SKIP);
}
require_utils.onHotReload("tooltip", () => [
	require_utils.on(document, "blur focus mouseover", handleInterest, require_utils.QUICK_EVENT),
	require_utils.on(document, "toggle", handleClose, require_utils.QUICK_EVENT),
	require_utils.onMutation(document, handleAriaAttributes, {
		attributeFilter: ["data-tooltip"],
		attributes: true,
		childList: true,
		subtree: true
	})
]);

//#endregion
//# sourceMappingURL=tooltip.cjs.map