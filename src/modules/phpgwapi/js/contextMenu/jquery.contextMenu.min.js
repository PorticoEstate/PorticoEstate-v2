!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}(function(e){"use strict";var t,n=function(e){return"function"==typeof e},o=function(e){if(!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))return!1;var t=Date.now(),n=e.is("input, textarea, select")?e.closest(".context-menu-item"):e;if(!n||!n.length)return!1;var o=n.parent();if(!o||!o.length)return!1;if(o.hasClass("context-menu-root"))return!1;var a=o.data("_showTimestamp");return(a?t-a:1/0)<50};e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement,e.ui&&e.widget||(e.cleanData=(t=e.cleanData,function(n){var o,a,s;for(s=0;null!=n[s];s++){a=n[s];try{(o=e._data(a,"events"))&&o.remove&&e(a).triggerHandler("remove")}catch(e){}}t(n)}));var a=null,s=!1,i=e(window),c=0,r={},l={},u={},d={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,hideOnSecondTrigger:!1,useModal:!0,selectableSubMenu:!1,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(e,t,n){var o;if(t||n){if("maintain"===t&&"maintain"===n)o=e.$menu.position();else{var a=e.$menu.offsetParent().offset();o={top:n-a.top,left:t-a.left}}var s=i.scrollTop()+i.height(),c=i.scrollLeft()+i.width(),r=e.$menu.outerHeight(),l=e.$menu.outerWidth();o.top+r>s&&(o.top-=r),o.top<0&&(o.top=0),o.left+l>c&&(o.left-=l),o.left<0&&(o.left=0),e.$menu.css(o)}else e.determinePosition.call(this,e.$menu)},positionSubmenu:function(t){if(void 0!==t)if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var n={top:-9,left:this.outerWidth()-5};t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{preShow:e.noop,show:e.noop,hide:e.noop,activated:e.noop},callback:null,items:{}},m={timer:null,pageX:null,pageY:null},p={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var n=e(this);if(!1!==t.data.events.preShow(n,t)&&("right"===t.data.trigger&&(t.preventDefault(),t.stopImmediatePropagation()),!("right"!==t.data.trigger&&"demand"!==t.data.trigger&&t.originalEvent||!(void 0===t.mouseButton||!t.data||"left"===t.data.trigger&&0===t.mouseButton||"right"===t.data.trigger&&2===t.mouseButton)||n.hasClass("context-menu-active")||n.hasClass("context-menu-disabled")))){if(a=n,t.data.build){var o=t.data.build(a,t);if(!1===o)return;if(t.data=e.extend(!0,{},d,t.data,o||{}),!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log).call(console,"No items specified to show in contextMenu"),new Error("No Items specified");t.data.$trigger=a,f.create(t.data)}f.show.call(n,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var n=e(this);a&&a.length&&!a.is(n)&&a.data("contextMenu").$menu.trigger("contextmenu:hide"),2===t.button&&(a=n.data("contextMenuActive",!0))},mouseup:function(t){var n=e(this);n.data("contextMenuActive")&&a&&a.length&&a.is(n)&&!n.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),a=n,n.trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),n.removeData("contextMenuActive")},mouseenter:function(t){var n=e(this),o=e(t.relatedTarget),s=e(document);o.is(".context-menu-list")||o.closest(".context-menu-list").length||a&&a.length||(m.pageX=t.pageX,m.pageY=t.pageY,m.data=t.data,s.on("mousemove.contextMenuShow",p.mousemove),m.timer=setTimeout(function(){m.timer=null,s.off("mousemove.contextMenuShow"),a=n,n.trigger(e.Event("contextmenu",{data:m.data,pageX:m.pageX,pageY:m.pageY}))},t.data.delay))},mousemove:function(e){m.pageX=e.pageX,m.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(!n.is(".context-menu-list")&&!n.closest(".context-menu-list").length){try{clearTimeout(m.timer)}catch(t){}m.timer=null}},layerClick:function(t,n,o){var a,s,c=e(this),r=void 0!==n?n:c.data("contextMenuRoot"),l=t.button,u=t.pageX,d=t.pageY;if(void 0===u)null!=r&&null!==r.$menu&&void 0!==r.$menu&&r.$menu.trigger("contextmenu:hide");else{if(!r.$layer)return a=document.elementFromPoint(u-i.scrollLeft(),d-i.scrollTop()),void(null!==r.$menu&&void 0!==r.$menu&&r.$menu[0].contains(a)||(r.$menu.trigger("contextmenu:hide"),void 0!==o&&o()));t.preventDefault(),setTimeout(function(){var n,o="left"===r.trigger&&0===l||"right"===r.trigger&&2===l;if(document.elementFromPoint&&r.$layer){if(r.$layer.hide(),null!==(a=document.elementFromPoint(u-i.scrollLeft(),d-i.scrollTop()))&&a.isContentEditable){var c=document.createRange(),m=window.getSelection();c.selectNode(a),c.collapse(!0),m.removeAllRanges(),m.addRange(c)}e(a).trigger(t),r.$layer.show()}if(r.hideOnSecondTrigger&&o&&null!==r.$menu&&void 0!==r.$menu)r.$menu.trigger("contextmenu:hide");else{if(r.reposition&&o)if(document.elementFromPoint){if(r.$trigger.is(a))return void r.position.call(r.$trigger,r,u,d)}else if(s=r.$trigger.offset(),n=e(window),s.top+=n.scrollTop(),s.top<=t.pageY&&(s.left+=n.scrollLeft(),s.left<=t.pageX&&(s.bottom=s.top+r.$trigger.outerHeight(),s.bottom>=t.pageY&&(s.right=s.left+r.$trigger.outerWidth(),s.right>=t.pageX))))return void r.position.call(r.$trigger,r,u,d);a&&o&&r.$trigger.one("contextmenu:hidden",function(){e(a).contextMenu({x:u,y:d,button:l})}),null!=r&&null!==r.$menu&&void 0!==r.$menu&&r.$menu.trigger("contextmenu:hide")}},50)}},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t={};a&&(t=a.data("contextMenu")||{}),void 0===t.zIndex&&(t.zIndex=0);var n=0,o=function(e){""!==e.style.zIndex?n=e.style.zIndex:null!==e.offsetParent&&void 0!==e.offsetParent?o(e.offsetParent):null!==e.parentElement&&void 0!==e.parentElement&&o(e.parentElement)};if(o(e.target),!(t.$menu&&parseInt(n,10)>parseInt(t.$menu.css("zIndex"),10))){switch(e.keyCode){case 9:case 38:if(p.keyStop(e,t),t.isInput){if(9===e.keyCode&&e.shiftKey)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("prevcommand"));if(38===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault()}else if(9!==e.keyCode||e.shiftKey)return void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("prevcommand"));break;case 40:if(p.keyStop(e,t),!t.isInput)return void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("nextcommand"));if(9===e.keyCode)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("nextcommand"));if(40===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault();break;case 37:if(p.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var s=t.$selected.parent().parent();return t.$selected.trigger("contextmenu:blur"),void(t.$selected=s)}break;case 39:if(p.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;var i=t.$selected.data("contextMenu")||{};if(i.$menu&&t.$selected.hasClass("context-menu-submenu"))return t.$selected=null,i.$selected=null,void i.$menu.trigger("nextcommand");break;case 35:case 36:return t.$selected&&t.$selected.find("input, textarea, select").length?void 0:((t.$selected&&t.$selected.parent()||t.$menu).children(":not(."+t.classNames.disabled+", ."+t.classNames.notSelectable+")")[36===e.keyCode?"first":"last"]().trigger("contextmenu:focus"),void e.preventDefault());case 13:if(p.keyStop(e,t),t.isInput){if(t.$selected&&!t.$selected.is("textarea, select"))return void e.preventDefault();break}return void(void 0!==t.$selected&&null!==t.$selected&&t.$selected.trigger("mouseup"));case 32:case 33:case 34:return void p.keyStop(e,t);case 27:return p.keyStop(e,t),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("contextmenu:hide"));default:var c=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys&&t.accesskeys[c])return void t.accesskeys[c].$node.trigger(t.accesskeys[c].$menu?"contextmenu:focus":"mouseup")}e.stopPropagation(),void 0!==t.$selected&&null!==t.$selected&&t.$selected.trigger(e)}},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{},o=e(this).data("contextMenuRoot")||{};if(n.$selected){var a=n.$selected;(n=n.$selected.parent().data("contextMenu")||{}).$selected=a}for(var s=n.$menu.children(),i=n.$selected&&n.$selected.prev().length?n.$selected.prev():s.last(),c=i;i.hasClass(o.classNames.disabled)||i.hasClass(o.classNames.notSelectable)||i.is(":hidden");)if((i=i.prev().length?i.prev():s.last()).is(c))return;n.$selected&&p.itemMouseleave.call(n.$selected.get(0),t),p.itemMouseenter.call(i.get(0),t);var r=i.find("input, textarea, select");r.length&&r.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{},o=e(this).data("contextMenuRoot")||{};if(n.$selected){var a=n.$selected;(n=n.$selected.parent().data("contextMenu")||{}).$selected=a}for(var s=n.$menu.children(),i=n.$selected&&n.$selected.next().length?n.$selected.next():s.first(),c=i;i.hasClass(o.classNames.disabled)||i.hasClass(o.classNames.notSelectable)||i.is(":hidden");)if((i=i.next().length?i.next():s.first()).is(c))return;n.$selected&&p.itemMouseleave.call(n.$selected.get(0),t),p.itemMouseenter.call(i.get(0),t);var r=i.find("input, textarea, select");r.length&&r.focus()},focusInput:function(){var t=e(this).closest(".context-menu-item"),n=t.data(),o=n.contextMenu,a=n.contextMenuRoot;a.$selected=o.$selected=t,a.isInput=o.isInput=!0},blurInput:function(){var t=e(this).closest(".context-menu-item").data(),n=t.contextMenu;t.contextMenuRoot.isInput=n.isInput=!1},menuMouseenter:function(){e(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(t){var n=e(this),a=n.data(),s=a.contextMenu,i=a.contextMenuRoot;o(n)||(i.hovering=!0,t&&i.$layer&&i.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(s.$menu?s:i).$menu.children("."+i.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur"),n.hasClass(i.classNames.disabled)||n.hasClass(i.classNames.notSelectable)?s.$selected=null:n.trigger("contextmenu:focus"))},itemMouseleave:function(t){var n=e(this),o=n.data(),a=o.contextMenu,s=o.contextMenuRoot;if(s!==a&&s.$layer&&s.$layer.is(t.relatedTarget))return void 0!==s.$selected&&null!==s.$selected&&s.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),void(s.$selected=a.$selected=a.$node);a&&a.$menu&&a.$menu.hasClass("context-menu-visible")||n.trigger("contextmenu:blur")},itemClick:function(t){var a,s=e(this),i=s.data(),c=i.contextMenu,r=i.contextMenuRoot,l=i.contextMenuKey;if(o(s))return t.preventDefault(),void t.stopImmediatePropagation();if(s.is(".context-menu-submenu")&&!1===r.selectableSubMenu)return t.preventDefault(),void t.stopImmediatePropagation();if(c.items[l]&&!s.is("."+r.classNames.disabled+", .context-menu-separator, ."+r.classNames.notSelectable)){if(t.preventDefault(),t.stopImmediatePropagation(),n(c.callbacks[l])&&Object.prototype.hasOwnProperty.call(c.callbacks,l))a=c.callbacks[l];else{if(!n(r.callback))return;a=r.callback}!1!==a.call(r.$trigger,l,r,t)?r.$menu.trigger("contextmenu:hide"):r.$menu.parent().length&&f.update.call(r.$trigger,r)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,n){var o=e(this).data("contextMenuRoot");f.hide.call(o.$trigger,o,n&&n.force)},focusItem:function(t){t.stopPropagation();var n=e(this),o=n.data(),a=o.contextMenu,s=o.contextMenuRoot;if(!n.hasClass(s.classNames.disabled)&&!n.hasClass(s.classNames.notSelectable)&&(n.addClass([s.classNames.hover,s.classNames.visible].join(" ")).parent().find(".context-menu-item").not(n).removeClass(s.classNames.visible).filter("."+s.classNames.hover).trigger("contextmenu:blur"),a.$selected=s.$selected=n,a&&a.$node&&a.$node.hasClass("context-menu-submenu")&&a.$node.addClass(s.classNames.hover),a.$node&&(s.positionSubmenu.call(a.$node,a.$menu),a.$menu))){var i=Date.now();a.$menu.data("_showTimestamp",i)}},blurItem:function(t){t.stopPropagation();var n=e(this),o=n.data(),a=o.contextMenu,s=o.contextMenuRoot;a.autoHide&&n.removeClass(s.classNames.visible),n.removeClass(s.classNames.hover),a.$selected=null}},f={show:function(t,n,o){var s=e(this),i={};if(e("#context-menu-layer").length>0?e("#context-menu-layer").trigger("mousedown"):e(document).trigger("contextmenu:hide"),t.$trigger=s,!1!==t.events.show.call(s,t))if(!1!==f.update.call(s,t)){if(t.position.call(s,t,n,o),t.zIndex){var c=t.zIndex;"function"==typeof t.zIndex&&(c=t.zIndex.call(s,t)),i.zIndex=function(e){for(var t=0,n=e;t=Math.max(t,parseInt(n.css("z-index"),10)||0),(n=n.parent())&&n.length&&!("html body".indexOf(n.prop("nodeName").toLowerCase())>-1););return t}(s)+c}f.layer.call(t.$menu,t,i.zIndex),t.$menu.find("ul").css("zIndex",i.zIndex+1),t.$menu.css(i)[t.animation.show](t.animation.duration,function(){s.trigger("contextmenu:visible");var e=Date.now();t.$menu.data("_showTimestamp",e),f.activated(t),t.events.activated(t)}),s.data("contextMenu",t).addClass("context-menu-active"),e(document).off("keydown.contextMenu").on("keydown.contextMenu",p.key),t.autoHide&&e(document).on("mousemove.contextMenuAutoHide",function(e){var n=s.offset();n.right=n.left+s.outerWidth(),n.bottom=n.top+s.outerHeight(),!t.$layer||t.hovering||e.pageX>=n.left&&e.pageX<=n.right&&e.pageY>=n.top&&e.pageY<=n.bottom||setTimeout(function(){t.hovering||null===t.$menu||void 0===t.$menu||t.$menu.trigger("contextmenu:hide")},50)})}else a=null;else a=null},hide:function(t,n){var o=e(this);if(t||(t=o.data("contextMenu")||{}),n||!t.events||!1!==t.events.hide.call(o,t)){if(o.removeData("contextMenu").removeClass("context-menu-active"),t.$layer){setTimeout((s=t.$layer,function(){s.remove()}),10);try{delete t.$layer}catch(e){t.$layer=null}}var s;a=null,t.$menu.find("."+t.classNames.hover).trigger("contextmenu:blur"),t.$selected=null,t.$menu.find("."+t.classNames.visible).removeClass(t.classNames.visible),e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),t.$menu&&t.$menu[t.animation.hide](t.animation.duration,function(){t.build&&(t.$menu.remove(),e.each(t,function(e){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:t[e]=void 0;try{delete t[e]}catch(e){}return!0}})),setTimeout(function(){o.trigger("contextmenu:hidden")},10)})}},create:function(t,a){void 0===a&&(a=t);var s=function(t){var n=e(this);if(o(n))return t.preventDefault(),t.stopImmediatePropagation(),!1};function i(t){var n=e("<span></span>");if(t._accesskey)t._beforeAccesskey&&n.append(document.createTextNode(t._beforeAccesskey)),e("<span></span>").addClass("context-menu-accesskey").text(t._accesskey).appendTo(n),t._afterAccesskey&&n.append(document.createTextNode(t._afterAccesskey));else if(t.isHtmlName){if(void 0!==t.accesskey)throw new Error("accesskeys are not compatible with HTML names and cannot be used together in the same item");n.html(t.name)}else n.text(t.name);return n}t.$menu=e('<ul class="context-menu-list"></ul>').addClass(t.className||"").data({contextMenu:t,contextMenuRoot:a}),t.dataAttr&&e.each(t.dataAttr,function(e,n){t.$menu.attr("data-"+t.key,n)}),e.each(["callbacks","commands","inputs"],function(e,n){t[n]={},a[n]||(a[n]={})}),a.accesskeys||(a.accesskeys={}),e.each(t.items,function(o,c){var r=e('<li class="context-menu-item"></li>').addClass(c.className||""),l=null,d=null;if(r.on("click",e.noop),"string"!=typeof c&&"cm_separator"!==c.type||(c={type:"cm_seperator"}),c.$node=r.data({contextMenu:t,contextMenuRoot:a,contextMenuKey:o}),void 0!==c.accesskey)for(var m,h=function(e){for(var t,n=e.split(/\s+/),o=[],a=0;t=n[a];a++)t=t.charAt(0).toUpperCase(),o.push(t);return o}(c.accesskey),v=0;m=h[v];v++)if(!a.accesskeys[m]){a.accesskeys[m]=c;var g=c.name.match(new RegExp("^(.*?)("+m+")(.*)$","i"));g&&(c._beforeAccesskey=g[1],c._accesskey=g[2],c._afterAccesskey=g[3]);break}if(c.type&&u[c.type])u[c.type].call(r,c,t,a),e.each([t,a],function(e,a){a.commands[o]=c,!n(c.callback)||void 0!==a.callbacks[o]&&void 0!==t.type||(a.callbacks[o]=c.callback)});else{switch("cm_seperator"===c.type?r.addClass("context-menu-separator "+a.classNames.notSelectable):"html"===c.type?r.addClass("context-menu-html "+a.classNames.notSelectable):"sub"!==c.type&&c.type?(l=e("<label></label>").appendTo(r),i(c).appendTo(l),r.addClass("context-menu-input"),t.hasTypes=!0,e.each([t,a],function(e,t){t.commands[o]=c,t.inputs[o]=c})):c.items&&(c.type="sub"),c.type){case"cm_seperator":break;case"text":d=e('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+o).val(c.value||"").appendTo(l);break;case"textarea":d=e('<textarea name=""></textarea>').attr("name","context-menu-input-"+o).val(c.value||"").appendTo(l),c.height&&d.height(c.height);break;case"checkbox":(d=e('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+o).val(c.value||"").prop("checked",!!c.selected).prependTo(l)).on("click",s);break;case"radio":(d=e('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+c.radio).val(c.value||"").prop("checked",!!c.selected).prependTo(l)).on("click",s);break;case"select":d=e('<select name=""></select>').attr("name","context-menu-input-"+o).appendTo(l),c.options&&(e.each(c.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(d)}),d.val(c.selected));break;case"sub":i(c).appendTo(r),c.appendTo=c.$node,r.data("contextMenu",c).addClass("context-menu-submenu"),c.callback=null,"function"==typeof c.items.then?f.processPromises(c,a,c.items):f.create(c,a);break;case"html":e(c.html).appendTo(r);break;default:e.each([t,a],function(e,a){a.commands[o]=c,!n(c.callback)||void 0!==a.callbacks[o]&&void 0!==t.type||(a.callbacks[o]=c.callback)}),i(c).appendTo(r)}c.type&&"sub"!==c.type&&"html"!==c.type&&"cm_seperator"!==c.type&&(d.on("focus",p.focusInput).on("blur",p.blurInput),c.events&&d.on(c.events,t)),c.icon&&(n(c.icon)?c._icon=c.icon.call(this,this,r,o,c):"string"!=typeof c.icon||"fab "!==c.icon.substring(0,4)&&"fas "!==c.icon.substring(0,4)&&"fad "!==c.icon.substring(0,4)&&"far "!==c.icon.substring(0,4)&&"fal "!==c.icon.substring(0,4)?"string"==typeof c.icon&&"fa-"===c.icon.substring(0,3)?c._icon=a.classNames.icon+" "+a.classNames.icon+"--fa fa "+c.icon:c._icon=a.classNames.icon+" "+a.classNames.icon+"-"+c.icon:(r.addClass(a.classNames.icon+" "+a.classNames.icon+"--fa5"),c._icon=e('<i class="'+c.icon+'"></i>')),"string"==typeof c._icon?r.addClass(c._icon):r.prepend(c._icon))}c.$input=d,c.$label=l,r.appendTo(t.$menu),!t.hasTypes&&e.support.eventSelectstart&&r.on("selectstart.disableTextSelect",p.abortevent)}),t.$node||t.$menu.css("display","none").addClass("context-menu-root"),t.$menu.appendTo(t.appendTo||document.body)},resize:function(t,n){var o;t.css({position:"absolute",display:"block"}),t.data("width",(o=t.get(0)).getBoundingClientRect?Math.ceil(o.getBoundingClientRect().width):t.outerWidth()+1),t.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),t.find("> li > ul").each(function(){f.resize(e(this),!0)}),n||t.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return e(this).data("width")})},update:function(t,o){var a=this;void 0===o&&(o=t,f.resize(t.$menu));var s=!1;return t.$menu.children().each(function(){var i,c=e(this),r=c.data("contextMenuKey"),l=t.items[r],u=n(l.disabled)&&l.disabled.call(a,r,o)||!0===l.disabled;if((i=n(l.visible)?l.visible.call(a,r,o):void 0===l.visible||!0===l.visible)&&(s=!0),c[i?"show":"hide"](),c[u?"addClass":"removeClass"](o.classNames.disabled),n(l.icon)){c.removeClass(l._icon);var d=l.icon.call(this,a,c,r,l);"string"==typeof d?c.addClass(d):c.prepend(d)}if(l.type)switch(c.find("input, select, textarea").prop("disabled",u),l.type){case"text":case"textarea":l.$input.val(l.value||"");break;case"checkbox":case"radio":l.$input.val(l.value||"").prop("checked",!!l.selected);break;case"select":l.$input.val((0===l.selected?"0":l.selected)||"")}l.$menu&&(f.update.call(a,l,o)&&(s=!0))}),s},layer:function(t,n){if(t.useModal){var o=t.$layer=e('<div id="context-menu-layer"></div>').css({height:i.height(),width:i.width(),display:"block",position:"fixed","z-index":n-1,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",t).appendTo(document.body).on("contextmenu",p.abortevent).on("mousedown",p.layerClick);return void 0===document.body.style.maxWidth&&o.css({position:"absolute",height:e(document).height()}),o}var a=function(e){p.layerClick(e,t,function(){document.removeEventListener("mousedown",a,!0)})};document.addEventListener("mousedown",a,!0)},processPromises:function(e,t,n){function o(e,t,n){void 0===n?(n={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}},window.console&&(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')):"string"==typeof n&&(n={error:{name:n}}),a(e,t,n)}function a(e,t,n){void 0!==t.$menu&&t.$menu.is(":visible")&&(e.$node.removeClass(t.classNames.iconLoadingClass),e.items=n,f.create(e,t,!0),f.update(e,t),t.positionSubmenu.call(e.$node,e.$menu))}e.$node.addClass(t.classNames.iconLoadingClass),n.then(function(e,t,n){void 0===n&&o(void 0),a(e,t,n)}.bind(this,e,t),o.bind(this,e,t))},activated:function(t){var n=t.$menu,o=n.offset(),a=e(window).height(),s=e(window).width(),i=e(window).scrollTop(),c=e(window).scrollLeft(),r=n.height(),l=n.outerHeight(),u=n.outerWidth();r>a?n.css({height:a+"px","overflow-x":"hidden","overflow-y":"auto",top:i+"px"}):o.top<i?n.css({top:i+"px"}):o.top+l>i+a&&n.css({top:o.top-(o.top+l-(i+a))+"px"}),o.left+u>c+s&&n.css({left:o.left-(o.left+u-(c+s))+"px"})}};function h(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function v(t,n,o){return o||(o=0),n.each(function(){var n,a,s=e(this),i=this,c=this.nodeName.toLowerCase();switch("label"===c&&s.find("input, textarea, select").length&&(n=s.text(),c=(i=(s=s.children().first()).get(0)).nodeName.toLowerCase()),c){case"menu":a={name:s.attr("label"),items:{}},o=v(a.items,s.children(),o);break;case"a":case"button":a={name:s.text(),disabled:!!s.attr("disabled"),callback:function(e,t,n){null!==s.get(0).onclick?s.get(0).click():t.callback(e,t,n)}};break;case"menuitem":case"command":switch(s.attr("type")){case void 0:case"command":case"menuitem":a={name:s.attr("label"),disabled:!!s.attr("disabled"),icon:s.attr("icon"),callback:function(e,t,n){null!==s.get(0).onclick?s.get(0).click():t.callback(e,t,n)}};break;case"checkbox":a={type:"checkbox",disabled:!!s.attr("disabled"),name:s.attr("label"),selected:!!s.attr("checked")};break;case"radio":a={type:"radio",disabled:!!s.attr("disabled"),name:s.attr("label"),radio:s.attr("radiogroup"),value:s.attr("id"),selected:!!s.attr("checked")};break;default:a=void 0}break;case"hr":a="-------";break;case"input":switch(s.attr("type")){case"text":a={type:"text",name:n||h(i),disabled:!!s.attr("disabled"),value:s.val()};break;case"checkbox":a={type:"checkbox",name:n||h(i),disabled:!!s.attr("disabled"),selected:!!s.attr("checked")};break;case"radio":a={type:"radio",name:n||h(i),disabled:!!s.attr("disabled"),radio:!!s.attr("name"),value:s.val(),selected:!!s.attr("checked")};break;default:a=void 0}break;case"select":a={type:"select",name:n||h(i),disabled:!!s.attr("disabled"),selected:s.val(),options:{}},s.children().each(function(){a.options[this.value]=e(this).text()});break;case"textarea":a={type:"textarea",name:n||h(i),disabled:!!s.attr("disabled"),value:s.val()};break;case"label":break;default:a={type:"html",html:s.clone(!0)}}a&&(o++,t["key"+o]=a)}),o}e.fn.contextMenu=function(t){var n=this,o=t;if(this.length>0)if(void 0===t)this.first().trigger("contextmenu");else if(void 0!==t.x&&void 0!==t.y)this.first().trigger(e.Event("contextmenu",{pageX:t.x,pageY:t.y,mouseButton:t.button}));else if("hide"===t){var a=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;a&&a.trigger("contextmenu:hide")}else"destroy"===t?e.contextMenu("destroy",{context:this}):e.isPlainObject(t)?(t.context=this,e.contextMenu("create",t)):t?this.removeClass("context-menu-disabled"):t||this.addClass("context-menu-disabled");else e.each(l,function(){this.selector===n.selector&&(o.data=this,e.extend(o.data,{trigger:"demand"}))}),p.contextmenu.call(o.target,o);return this},e.contextMenu=function(t,n){"string"!=typeof t&&(n=t,t="create"),"string"==typeof n?n={selector:n}:void 0===n&&(n={});var o=e.extend(!0,{},d,n||{}),a=e(document),i=a,u=!1;switch(o.context&&o.context.length?(i=e(o.context).first(),o.context=i.get(0),u=!e(o.context).is(document)):o.context=document,t){case"update":if(u)f.update(i);else for(var m in l)l.hasOwnProperty(m)&&f.update(l[m]);break;case"create":if(!o.selector)throw new Error("No selector specified");if(o.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className');if(!o.build&&(!o.items||e.isEmptyObject(o.items)))throw new Error("No Items specified");if(c++,o.ns=".contextMenu"+c,u||(r[o.selector]=o.ns),l[o.ns]=o,o.trigger||(o.trigger="right"),!s){var h="click"===o.itemClickEvent?"click.contextMenu":"mouseup.contextMenu",v={"contextmenu:focus.contextMenu":p.focusItem,"contextmenu:blur.contextMenu":p.blurItem,"contextmenu.contextMenu":p.abortevent,"mouseenter.contextMenu":p.itemMouseenter,"mouseleave.contextMenu":p.itemMouseleave};v[h]=p.itemClick,a.on({"contextmenu:hide.contextMenu":p.hideMenu,"prevcommand.contextMenu":p.prevItem,"nextcommand.contextMenu":p.nextItem,"contextmenu.contextMenu":p.abortevent,"mouseenter.contextMenu":p.menuMouseenter,"mouseleave.contextMenu":p.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",p.inputClick).on(v,".context-menu-item"),s=!0}switch(i.on("contextmenu"+o.ns,o.selector,o,p.contextmenu),u&&i.on("remove"+o.ns,function(){e(this).contextMenu("destroy")}),o.trigger){case"hover":i.on("mouseenter"+o.ns,o.selector,o,p.mouseenter).on("mouseleave"+o.ns,o.selector,o,p.mouseleave);break;case"left":i.on("click"+o.ns,o.selector,o,p.click);break;case"touchstart":i.on("touchstart"+o.ns,o.selector,o,p.click)}o.build||f.create(o);break;case"destroy":var g;if(u){var x=o.context;e.each(l,function(t,n){if(!n)return!0;if(!e(x).is(n.selector))return!0;(g=e(".context-menu-list").filter(":visible")).length&&g.data().contextMenuRoot.$trigger.is(e(n.context).find(n.selector))&&g.trigger("contextmenu:hide",{force:!0});try{l[n.ns].$menu&&l[n.ns].$menu.remove(),delete l[n.ns]}catch(e){l[n.ns]=null}return e(n.context).off(n.ns),!0})}else if(o.selector){if(r[o.selector]){(g=e(".context-menu-list").filter(":visible")).length&&g.data().contextMenuRoot.$trigger.is(o.selector)&&g.trigger("contextmenu:hide",{force:!0});try{l[r[o.selector]].$menu&&l[r[o.selector]].$menu.remove(),delete l[r[o.selector]]}catch(e){l[r[o.selector]]=null}a.off(r[o.selector])}}else a.off(".contextMenu .contextMenuAutoHide"),e.each(l,function(t,n){e(n.context).off(n.ns)}),r={},l={},c=0,s=!1,e("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof n&&n)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+t+'"')}return this},e.contextMenu.setInputValues=function(t,n){void 0===n&&(n={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=n[e]||"";break;case"checkbox":t.selected=!!n[e];break;case"radio":t.selected=(n[t.radio]||"")===t.value;break;case"select":t.selected=n[e]||""}})},e.contextMenu.getInputValues=function(t,n){return void 0===n&&(n={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":n[e]=t.$input.val();break;case"checkbox":n[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(n[t.radio]=t.value)}}),n},e.contextMenu.fromMenu=function(t){var n={};return v(n,e(t).children()),n},e.contextMenu.defaults=d,e.contextMenu.types=u,e.contextMenu.handle=p,e.contextMenu.op=f,e.contextMenu.menus=l});