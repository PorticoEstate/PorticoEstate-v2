{"version":3,"file":"tooltip.js","names":[],"sources":["../../src/tooltip.ts"],"sourcesContent":["import {\r\n  attr,\r\n  attrRequiredWarning,\r\n  on,\r\n  onHotReload,\r\n  onMutation,\r\n  QUICK_EVENT,\r\n  tag,\r\n} from './utils';\r\n\r\nlet TIP: HTMLElement;\r\nlet SOURCE: Element | undefined;\r\nlet HOVER_TIMER: number | ReturnType<typeof setTimeout> = 0;\r\nlet SKIP_TIMER: number | ReturnType<typeof setTimeout> = 0;\r\nconst SELECTOR_TOOLTIP = '[data-tooltip-element]';\r\nconst SELECTOR_INTERACTIVE = 'a,button,input,select,textarea,[tabindex]';\r\nconst DELAY_HOVER = 300;\r\nconst DELAY_SKIP = 300;\r\n\r\n// TODO: Document using data-tooltip-element to set custom tooltip element\r\n\r\nfunction handleAriaAttributes() {\r\n  for (const el of document.querySelectorAll('[data-tooltip]')) {\r\n    const hasText = el.textContent?.trim();\r\n    const tooltip = attr(el, 'data-tooltip');\r\n\r\n    attr(el, hasText ? 'aria-description' : 'aria-label', tooltip);\r\n    if (!el.matches(SELECTOR_INTERACTIVE))\r\n      attrRequiredWarning(el, 'tabindex=\"0\"');\r\n  }\r\n}\r\n\r\nfunction handleInterest({ type, target }: Event) {\r\n  clearTimeout(HOVER_TIMER);\r\n\r\n  if (!TIP)\r\n    TIP =\r\n      document.querySelector<HTMLElement>(SELECTOR_TOOLTIP) ||\r\n      tag('div', { class: 'ds-tooltip' });\r\n\r\n  if (!TIP || target === TIP) return; // Allow tooltip to be hovered, following https://www.w3.org/TR/WCAG21/#content-on-hover-or-focus\r\n  if (type === 'mouseover' && !SOURCE) {\r\n    HOVER_TIMER = setTimeout(handleInterest, DELAY_HOVER, { target }); // Delay mouse showing tooltip if not already shown\r\n    return;\r\n  }\r\n\r\n  const source = (target as Element)?.closest?.('[data-tooltip]');\r\n  if (source === SOURCE) return; // No need to update\r\n  if (!TIP.isConnected) document.body.appendChild(TIP); // Ensure connected\r\n  if (!TIP.hasAttribute('popover')) attr(TIP, 'popover', 'manual'); // Ensure popover behavior\r\n  if (!source) return TIP?.hidePopover(); // If no new anchor, cleanup previous autoUpdate\r\n\r\n  clearTimeout(SKIP_TIMER);\r\n  TIP.textContent = attr(source, 'data-tooltip');\r\n  TIP.showPopover();\r\n  TIP.dispatchEvent(new CustomEvent('ds-toggle-source', { detail: source })); // Since showPopover({ source }) is not supported in all browsers yet\r\n  SOURCE = source;\r\n}\r\n\r\nfunction handleClose(event?: Partial<ToggleEvent>) {\r\n  if (!event) SOURCE = undefined;\r\n  else if (event.target === TIP && event.newState === 'closed')\r\n    SKIP_TIMER = setTimeout(handleClose, DELAY_SKIP);\r\n}\r\n\r\nonHotReload('tooltip', () => [\r\n  on(document, 'blur focus mouseover', handleInterest, QUICK_EVENT),\r\n  on(document, 'toggle', handleClose, QUICK_EVENT),\r\n  onMutation(document, handleAriaAttributes, {\r\n    attributeFilter: ['data-tooltip'],\r\n    attributes: true,\r\n    childList: true,\r\n    subtree: true,\r\n  }),\r\n]);\r\n"],"mappings":";;;AAUA,IAAI;AACJ,IAAI;AACJ,IAAI,cAAsD;AAC1D,IAAI,aAAqD;AACzD,MAAM,mBAAmB;AACzB,MAAM,uBAAuB;AAC7B,MAAM,cAAc;AACpB,MAAM,aAAa;AAInB,SAAS,uBAAuB;AAC9B,MAAK,MAAM,MAAM,SAAS,iBAAiB,iBAAiB,EAAE;EAC5D,MAAM,UAAU,GAAG,aAAa,MAAM;EACtC,MAAM,UAAU,KAAK,IAAI,eAAe;AAExC,OAAK,IAAI,UAAU,qBAAqB,cAAc,QAAQ;AAC9D,MAAI,CAAC,GAAG,QAAQ,qBAAqB,CACnC,qBAAoB,IAAI,iBAAe;;;AAI7C,SAAS,eAAe,EAAE,MAAM,UAAiB;AAC/C,cAAa,YAAY;AAEzB,KAAI,CAAC,IACH,OACE,SAAS,cAA2B,iBAAiB,IACrD,IAAI,OAAO,EAAE,OAAO,cAAc,CAAC;AAEvC,KAAI,CAAC,OAAO,WAAW,IAAK;AAC5B,KAAI,SAAS,eAAe,CAAC,QAAQ;AACnC,gBAAc,WAAW,gBAAgB,aAAa,EAAE,QAAQ,CAAC;AACjE;;CAGF,MAAM,SAAU,QAAoB,UAAU,iBAAiB;AAC/D,KAAI,WAAW,OAAQ;AACvB,KAAI,CAAC,IAAI,YAAa,UAAS,KAAK,YAAY,IAAI;AACpD,KAAI,CAAC,IAAI,aAAa,UAAU,CAAE,MAAK,KAAK,WAAW,SAAS;AAChE,KAAI,CAAC,OAAQ,QAAO,KAAK,aAAa;AAEtC,cAAa,WAAW;AACxB,KAAI,cAAc,KAAK,QAAQ,eAAe;AAC9C,KAAI,aAAa;AACjB,KAAI,cAAc,IAAI,YAAY,oBAAoB,EAAE,QAAQ,QAAQ,CAAC,CAAC;AAC1E,UAAS;;AAGX,SAAS,YAAY,OAA8B;AACjD,KAAI,CAAC,MAAO,UAAS;UACZ,MAAM,WAAW,OAAO,MAAM,aAAa,SAClD,cAAa,WAAW,aAAa,WAAW;;AAGpD,YAAY,iBAAiB;CAC3B,GAAG,UAAU,wBAAwB,gBAAgB,YAAY;CACjE,GAAG,UAAU,UAAU,aAAa,YAAY;CAChD,WAAW,UAAU,sBAAsB;EACzC,iBAAiB,CAAC,eAAe;EACjC,YAAY;EACZ,WAAW;EACX,SAAS;EACV,CAAC;CACH,CAAC"}