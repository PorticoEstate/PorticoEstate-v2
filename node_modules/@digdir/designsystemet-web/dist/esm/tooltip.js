import { QUICK_EVENT, attr, attrRequiredWarning, on, onHotReload, onMutation, tag } from "./utils.js";

//#region src/tooltip.ts
let TIP;
let SOURCE;
let HOVER_TIMER = 0;
let SKIP_TIMER = 0;
const SELECTOR_TOOLTIP = "[data-tooltip-element]";
const SELECTOR_INTERACTIVE = "a,button,input,select,textarea,[tabindex]";
const DELAY_HOVER = 300;
const DELAY_SKIP = 300;
function handleAriaAttributes() {
	for (const el of document.querySelectorAll("[data-tooltip]")) {
		const hasText = el.textContent?.trim();
		const tooltip = attr(el, "data-tooltip");
		attr(el, hasText ? "aria-description" : "aria-label", tooltip);
		if (!el.matches(SELECTOR_INTERACTIVE)) attrRequiredWarning(el, "tabindex=\"0\"");
	}
}
function handleInterest({ type, target }) {
	clearTimeout(HOVER_TIMER);
	if (!TIP) TIP = document.querySelector(SELECTOR_TOOLTIP) || tag("div", { class: "ds-tooltip" });
	if (!TIP || target === TIP) return;
	if (type === "mouseover" && !SOURCE) {
		HOVER_TIMER = setTimeout(handleInterest, DELAY_HOVER, { target });
		return;
	}
	const source = target?.closest?.("[data-tooltip]");
	if (source === SOURCE) return;
	if (!TIP.isConnected) document.body.appendChild(TIP);
	if (!TIP.hasAttribute("popover")) attr(TIP, "popover", "manual");
	if (!source) return TIP?.hidePopover();
	clearTimeout(SKIP_TIMER);
	TIP.textContent = attr(source, "data-tooltip");
	TIP.showPopover();
	TIP.dispatchEvent(new CustomEvent("ds-toggle-source", { detail: source }));
	SOURCE = source;
}
function handleClose(event) {
	if (!event) SOURCE = void 0;
	else if (event.target === TIP && event.newState === "closed") SKIP_TIMER = setTimeout(handleClose, DELAY_SKIP);
}
onHotReload("tooltip", () => [
	on(document, "blur focus mouseover", handleInterest, QUICK_EVENT),
	on(document, "toggle", handleClose, QUICK_EVENT),
	onMutation(document, handleAriaAttributes, {
		attributeFilter: ["data-tooltip"],
		attributes: true,
		childList: true,
		subtree: true
	})
]);

//#endregion
//# sourceMappingURL=tooltip.js.map